# Nova Sonic 管理控制台用户手册

## 📖 目录

1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [用户认证](#用户认证)
4. [设备管理](#设备管理)
5. [用户管理](#用户管理)
6. [MCP服务器管理](#mcp服务器管理)
7. [系统配置](#系统配置)
8. [事件监控](#事件监控)
9. [常见问题](#常见问题)
10. [故障排除](#故障排除)

---

## 系统概述

Nova Sonic 管理控制台是一个基于Web的管理界面，用于管理和配置Nova Sonic语音对话系统。通过这个控制台，您可以：

- 🎛️ **设备管理**：配置和监控连接的语音设备
- 👥 **用户管理**：管理系统用户和权限
- 🔧 **MCP服务器**：配置外部工具和服务集成
- 📊 **实时监控**：查看系统状态和事件日志
- ⚙️ **系统配置**：调整全局设置和参数

### 系统架构
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   语音设备      │◄──►│  Nova Sonic      │◄──►│   管理控制台    │
│  (硬件客户端)   │    │   后端服务       │    │ (Web界面)       │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

---

## 快速开始

### 系统要求
- 现代Web浏览器（Chrome、Firefox、Safari、Edge）
- 网络连接到Nova Sonic服务器
- 有效的用户账户

### 访问系统
1. 打开Web浏览器
2. 访问管理控制台地址：`http://your-server:3000`
3. 使用您的用户名和密码登录

### 默认管理员账户
- **用户名**：`admin`
- **密码**：`admin123`
- ⚠️ **重要**：首次登录后请立即修改默认密码

---

## 用户认证

### 登录系统

1. **访问登录页面**
   - 在浏览器中打开管理控制台地址
   - 系统会自动跳转到登录页面

2. **输入凭据**
   - 用户名：输入您的用户名
   - 密码：输入您的密码
   - 记住我：勾选此选项可保存用户名

3. **登录验证**
   - 点击"Sign In"按钮
   - 系统验证凭据后自动跳转到主界面

### 注册新账户

1. **访问注册页面**
   - 在登录页面点击"Create one here"链接

2. **填写注册信息**
   - **用户名**：3-20个字符，支持字母、数字、下划线
   - **密码**：至少6个字符，建议包含大小写字母和数字
   - **确认密码**：重复输入密码进行确认
   - **角色选择**：
     - `Device User`：设备用户，可连接设备到系统
     - `Administrator`：管理员，可管理系统和用户

3. **密码强度指示**
   - 🔴 **弱**：少于6个字符
   - 🟡 **中等**：6-7个字符
   - 🟢 **强**：8个字符以上，包含大写字母和数字

### 退出登录
- 点击右上角的"退出登录"按钮
- 系统会清除登录状态并跳转到登录页面

---

## 设备管理

设备管理是系统的核心功能，用于配置和监控所有连接到Nova Sonic系统的语音设备。

### 设备列表

#### 查看设备
1. 登录后默认显示设备列表
2. 或点击左侧导航栏的"设备列表"

#### 设备信息显示
每个设备卡片显示以下信息：
- **设备名称**：自定义的设备标识名
- **设备ID**：系统生成的唯一标识符（显示前12位）
- **连接状态**：
  - 🟢 **在线**：设备正常连接
  - 🔴 **离线**：设备未连接或断开
- **最后连接时间**：设备最近一次连接的时间
- **语音模型**：当前使用的语音合成模型
- **已启用工具**：显示设备启用的功能模块

#### 自动刷新
- 设备列表每5秒自动刷新一次
- 确保显示最新的设备状态

### 设备配置

#### 打开配置界面
1. 在设备列表中找到要配置的设备
2. 点击"配置设备"按钮
3. 系统打开设备配置模态框

#### 基本配置

**设备信息**
- **设备名称**：为设备设置易于识别的名称
  - 示例：`客厅音箱`、`办公室助手`、`卧室设备`
- **语音模型**：选择语音合成声音
  - Matthew (英语-美国-男声)
  - Tiffany (英语-美国-女声)
  - Amy (英语-英国-女声)
  - Ambre (法语-女声)
  - Florian (法语-男声)
  - Beatrice (意大利语-女声)
  - Lorenzo (意大利语-男声)
  - Greta (德语-女声)
  - Lennart (德语-男声)
  - Lupe (西班牙语-女声)
  - Carlos (西班牙语-男声)

**系统提示词**
- 定义AI助手的角色和行为方式
- 示例：
  ```
  你是一个友好的AI助手，专门帮助用户解决日常问题。
  请用简洁、准确的语言回答问题，保持礼貌和专业。
  ```

**模型参数**
- **最大令牌数**：控制回复的最大长度（建议：512-2048）
- **温度值**：控制回复的创造性（0.0-1.0，建议：0.7）
- **Top P**：控制词汇选择的多样性（0.0-1.0，建议：0.95）

#### 内置工具配置

**AWS Bedrock 知识库**
- ✅ 启用知识库查询功能
- 配置知识库ID：输入AWS Bedrock知识库的ID
- 用途：为AI提供专业领域知识支持

**AWS Bedrock Agents**
- ✅ 启用Bedrock智能代理
- 配置Lambda函数ARN：输入处理代理请求的Lambda函数ARN
- 用途：提供复杂任务处理和业务流程自动化

**Strands 天气代理**
- ✅ 启用Strands天气查询
- 用途：提供实时天气信息查询功能

**传统MCP支持**
- ✅ 启用传统MCP位置服务
- 用途：向后兼容的Model Context Protocol位置查询

#### MCP服务器配置

**选择MCP服务器**
1. 点击"MCP服务器"标签页
2. 在下拉列表中选择要启用的MCP服务器
3. 可以选择多个服务器同时启用

**管理MCP服务器**
1. 点击"管理MCP服务器"按钮
2. 在弹出的管理界面中添加、编辑或删除MCP服务器
3. 详细配置请参考[MCP服务器管理](#mcp服务器管理)章节

#### 保存配置
1. 完成所有配置后，点击"保存配置"按钮
2. 系统会自动应用新配置
3. 如果配置涉及会话重启项，系统会自动重启设备会话

### 设备操作

#### 重启会话
1. 在设备配置界面或通过API
2. 点击相应的操作按钮
3. 系统会断开当前会话并重新初始化

#### 会话自动重启
以下配置变更会自动触发会话重启：
- 系统提示词修改
- 语音模型更换
- MCP服务器配置变更
- 内置工具启用/禁用状态变更

---

## 用户管理

用户管理功能允许管理员创建、管理系统用户账户和权限。

### 访问用户管理
1. 点击左侧导航栏的"用户管理"
2. 需要管理员权限才能访问

### 用户列表

#### 查看用户信息
用户列表显示以下信息：
- **用户名**：用户的登录名
- **角色**：用户权限级别
  - 🔴 **管理员**：可以管理系统和用户
  - 🔵 **设备用户**：可以连接设备到系统
- **最后登录**：用户最近一次登录时间
- **特殊标识**：默认管理员账户会显示"默认"标签

### 创建新用户

#### 操作步骤
1. 点击"创建用户"按钮
2. 填写用户信息：
   - **用户名**：3-20个字符，不可重复
   - **密码**：至少6个字符，建议使用强密码
   - **用户角色**：选择适当的权限级别

#### 角色说明
- **设备用户**：
  - 可以连接设备到系统
  - 可以使用设备进行语音对话
  - 无法访问管理功能
- **管理员**：
  - 拥有所有设备用户权限
  - 可以管理其他用户
  - 可以配置系统设置
  - 可以查看系统日志

### 修改密码

#### 操作步骤
1. 点击"修改密码"按钮
2. 填写密码修改信息：
   - **用户名**：要修改密码的用户名
   - **当前密码**：用户的当前密码（用于验证）
   - **新密码**：设置新的登录密码

#### 密码要求
- 最少6个字符
- 建议包含大小写字母、数字和特殊字符
- 避免使用常见密码或个人信息

### 用户权限管理

#### 权限级别
1. **设备用户权限**：
   - 连接设备
   - 使用语音功能
   - 查看自己的设备状态

2. **管理员权限**：
   - 所有设备用户权限
   - 用户管理（创建、删除、修改）
   - 设备配置管理
   - MCP服务器管理
   - 系统配置
   - 日志查看

---

## MCP服务器管理

MCP (Model Context Protocol) 服务器管理允许您为AI助手添加自定义的外部工具和服务。

### MCP概述

#### 什么是MCP
MCP是一个协议，允许AI助手连接到外部工具和服务，扩展其能力范围。例如：
- 文件系统操作
- API服务调用
- 数据库查询
- 第三方服务集成

#### 连接类型
- **STDIO**：本地进程连接，适用于本地工具
- **SSE**：服务器推送事件，适用于实时数据流
- **HTTP**：HTTP连接，适用于Web服务

### 访问MCP管理

#### 方式一：通过设备配置
1. 在设备配置界面点击"MCP服务器"标签
2. 点击"管理MCP服务器"按钮

#### 方式二：直接访问
1. 在系统中找到MCP管理入口
2. 需要适当权限才能访问

### MCP服务器列表

#### 查看服务器信息
- **服务器名称**：MCP服务器的标识名称
- **连接类型**：STDIO、SSE或HTTP
- **端点**：连接地址或命令
- **工具名称**：AI助手调用时使用的工具名
- **操作**：编辑、删除按钮

### 添加MCP服务器

#### 基本信息
1. **服务器名称**：为MCP服务器设置易于识别的名称
   - 示例：`文件系统工具`、`天气API服务`、`数据库查询`

2. **连接类型**：选择适合的连接方式
   - **STDIO (Local Process)**：本地进程
   - **SSE (Server-Sent Events)**：服务器推送
   - **HTTP (Streamable HTTP)**：HTTP流式连接

#### STDIO连接配置
适用于本地工具和脚本：

**命令**：启动MCP服务器的命令
- 示例：`uvx`、`python`、`node`

**命令参数**：JSON数组格式的参数列表
```json
["package@latest", "--option", "value"]
```

**环境变量**：JSON对象格式的环境变量
```json
{
  "AWS_PROFILE": "default",
  "API_KEY": "your-api-key"
}
```

#### SSE/HTTP连接配置
适用于网络服务：

**服务器URL**：MCP服务器的网络地址
- 示例：`http://localhost:3000/mcp`
- 示例：`ws://localhost:3000/mcp`

**HTTP请求头**：JSON对象格式的请求头
```json
{
  "Authorization": "Bearer token",
  "Content-Type": "application/json"
}
```

#### 工具配置
**工具名称**：AI助手调用此工具时使用的名称
- 示例：`fileManager`、`weatherAPI`、`databaseQuery`

**工具功能描述**：告诉AI助手此工具的作用
- 示例：`管理文件系统`、`查询天气信息`、`数据库操作`

**详细说明**：对此MCP服务器的详细描述
- 包含功能说明、配置要求、使用注意事项等

### 编辑MCP服务器

1. 在服务器列表中找到要编辑的服务器
2. 点击"编辑"按钮
3. 修改相应配置项
4. 点击"保存"按钮应用更改

### 删除MCP服务器

1. 在服务器列表中找到要删除的服务器
2. 点击"删除"按钮
3. 确认删除操作
4. ⚠️ **注意**：删除操作不可恢复

### MCP服务器示例

#### 文件系统工具
```
名称：文件管理器
连接类型：STDIO
命令：uvx
参数：["mcp-server-filesystem@latest"]
工具名称：fileManager
描述：提供文件和目录操作功能
```

#### 天气API服务
```
名称：天气查询服务
连接类型：HTTP
URL：http://weather-api.example.com/mcp
工具名称：weatherAPI
描述：查询实时天气信息和预报
```

#### 数据库查询工具
```
名称：数据库查询
连接类型：STDIO
命令：python
参数：["db_mcp_server.py"]
环境变量：{"DB_URL": "postgresql://..."}
工具名称：databaseQuery
描述：执行数据库查询和操作
```

---

## 系统配置

系统配置页面提供全局设置和WebSocket连接管理功能。

### 访问系统配置
1. 点击左侧导航栏的"系统配置"
2. 需要适当权限才能访问

### WebSocket连接管理

#### 连接配置
**WebSocket服务器URL**：
- 默认：`ws://localhost:8081`
- 格式：`ws://服务器地址:端口`
- 用于连接到Nova Sonic后端服务

#### 连接操作
- **Connect**：建立WebSocket连接
- **Disconnect**：断开WebSocket连接
- **Test Connection**：测试连接并发送测试消息
- 连接状态实时显示在页面右上角

### 全局配置

#### 语音配置
**默认语音ID**：设置系统默认的语音合成模型
- 影响新创建设备的默认语音设置
- 可选择多种语言和性别的语音

#### 系统提示词
**默认系统提示词**：设置AI助手的默认行为
```
你是一个友好的AI助手，专门帮助用户解决问题。
请用简洁、准确的语言回答问题，保持礼貌和专业。
```

#### 工具配置
**默认工具配置**：JSON格式的工具配置
```json
{
  "toolConfig": {
    "tools": [],
    "toolChoice": "auto"
  }
}
```

#### 对话历史
**默认对话历史**：JSON格式的对话历史模板
```json
{
  "chatHistory": []
}
```

### 连接测试

#### 测试WebSocket连接
1. 点击"Test Connection"按钮
2. 系统发送测试消息到服务器
3. 查看连接状态和响应

#### 测试消息自定义
- 可以在测试对话框中输入自定义测试消息
- 系统会发送会话开始事件进行测试

### 事件管理

#### 清除事件日志
- 点击"Clear Events"按钮清除事件显示
- 不影响服务器端的日志记录

#### 重置计量器
- 点击"Reset Meter"按钮重置使用统计
- 重新开始计量API使用情况

---

## 事件监控

事件监控功能提供实时的系统事件查看和分析能力。

### 访问事件监控
1. 点击左侧导航栏的"事件日志"
2. 查看实时的系统事件流

### 事件类型

#### 输入事件 (IN)
- WebSocket接收到的事件
- 设备发送的消息
- 用户操作触发的事件

#### 输出事件 (OUT)
- 系统发送给设备的响应
- API调用结果
- 状态更新通知

### 事件信息

#### 事件显示格式
每个事件包含以下信息：
- **时间戳**：事件发生的精确时间
- **方向**：IN（输入）或OUT（输出）
- **事件类型**：具体的事件类别
- **事件内容**：JSON格式的详细数据

#### 常见事件类型
- `sessionStart`：会话开始
- `promptStart`：提示开始
- `audioInput`：音频输入
- `textInput`：文本输入
- `audioOutput`：音频输出
- `textOutput`：文本输出
- `usageEvent`：使用统计
- `error`：错误事件

### 事件过滤和搜索

#### 实时过滤
- 事件按时间顺序实时显示
- 自动滚动到最新事件
- 支持暂停和恢复显示

#### 事件管理
- **清除事件**：清空当前显示的事件列表
- **导出事件**：保存事件日志到文件（如果支持）
- **事件统计**：查看事件数量和类型统计

---

## 常见问题

### 登录问题

**Q: 忘记了管理员密码怎么办？**
A: 联系系统管理员重置密码，或通过服务器端直接修改数据库。

**Q: 登录后页面空白或无法加载？**
A: 
1. 检查浏览器控制台是否有错误信息
2. 确认网络连接正常
3. 尝试清除浏览器缓存和Cookie
4. 使用其他浏览器测试

**Q: 提示"Authentication required"错误？**
A: 
1. 检查用户名和密码是否正确
2. 确认用户账户是否被禁用
3. 检查服务器端认证服务是否正常

### 设备连接问题

**Q: 设备显示离线状态？**
A: 
1. 检查设备端网络连接
2. 确认WebSocket服务器地址配置正确
3. 查看设备端日志是否有错误信息
4. 检查防火墙设置

**Q: 设备配置保存后不生效？**
A: 
1. 检查是否有权限进行配置修改
2. 确认配置参数格式正确
3. 查看是否需要重启设备会话
4. 检查服务器端日志

**Q: 语音合成不工作？**
A: 
1. 检查语音模型配置是否正确
2. 确认AWS凭据配置正常
3. 检查网络连接到AWS服务
4. 查看API使用限制和配额

### MCP服务器问题

**Q: MCP服务器连接失败？**
A: 
1. 检查服务器地址和端口是否正确
2. 确认MCP服务器是否正在运行
3. 检查网络连接和防火墙设置
4. 验证认证信息是否正确

**Q: STDIO类型的MCP服务器无法启动？**
A: 
1. 检查命令路径是否正确
2. 确认所需的依赖是否已安装
3. 检查环境变量配置
4. 查看系统权限设置

### 性能问题

**Q: 页面加载缓慢？**
A: 
1. 检查网络连接速度
2. 清除浏览器缓存
3. 检查服务器负载情况
4. 优化浏览器设置

**Q: 实时更新延迟？**
A: 
1. 检查WebSocket连接状态
2. 确认网络延迟情况
3. 查看服务器性能指标
4. 检查客户端资源使用

---

## 故障排除

### 诊断步骤

#### 1. 检查系统状态
1. 查看连接状态指示器
2. 检查事件日志是否有错误
3. 确认用户权限是否足够
4. 验证网络连接是否正常

#### 2. 浏览器诊断
1. 打开浏览器开发者工具（F12）
2. 查看Console标签页的错误信息
3. 检查Network标签页的网络请求
4. 清除浏览器缓存和Cookie

#### 3. 服务器端检查
1. 查看服务器日志文件
2. 检查服务进程是否正常运行
3. 验证数据库连接状态
4. 确认API服务是否响应

### 常见错误代码

#### HTTP错误
- **401 Unauthorized**：认证失败，检查登录凭据
- **403 Forbidden**：权限不足，联系管理员
- **404 Not Found**：资源不存在，检查URL配置
- **500 Internal Server Error**：服务器内部错误，查看服务器日志

#### WebSocket错误
- **连接超时**：检查网络和服务器状态
- **连接被拒绝**：确认服务器地址和端口
- **认证失败**：检查用户凭据和权限

### 日志收集

#### 浏览器日志
1. 打开开发者工具（F12）
2. 切换到Console标签页
3. 复制错误信息和堆栈跟踪
4. 保存Network标签页的请求详情

#### 服务器日志
1. 查看应用程序日志文件
2. 检查WebSocket连接日志
3. 收集数据库操作日志
4. 记录系统资源使用情况

### 联系支持

如果问题无法解决，请联系技术支持并提供：
1. 详细的错误描述和重现步骤
2. 浏览器类型和版本信息
3. 相关的错误日志和截图
4. 系统配置和环境信息

---

## 附录

### 快捷键
- **Ctrl+R**：刷新页面
- **F12**：打开开发者工具
- **Ctrl+Shift+I**：打开开发者工具（备用）

### 浏览器兼容性
- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

### 系统限制
- 最大并发设备数：根据服务器配置
- 最大MCP服务器数：无限制
- 用户数量限制：根据许可证
- 会话超时时间：24小时

### 更新日志
- **v1.0.0**：初始版本发布
- 包含基本的设备管理、用户管理和MCP服务器管理功能

---

*本手册最后更新时间：2024年12月*